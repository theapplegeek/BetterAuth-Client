<div class="app-modal-panel max-w-2xl">
  <form
    class="space-y-4"
    [formGroup]="userForm"
    (ngSubmit)="saveUser()"
  >
    <div class="app-modal-header">
      <h3 class="app-modal-title">
        {{
          mode === 'create'
            ? 'Create User'
            : 'Edit User'
        }}
      </h3>
      <button
        class="app-modal-close"
        type="button"
        aria-label="Close dialog"
        (click)="onClose()"
      >
        <span
          class="icon-[heroicons--x-mark] size-5"
        ></span>
      </button>
    </div>
    <div class="gap-4 sm:grid-cols-2 grid">
      <div>
        <label
          class="mb-1 text-sm font-medium text-gray-700 dark:text-gray-300 block"
        >
          Name
        </label>
        <input
          class="rounded-lg border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-white w-full border"
          formControlName="name"
          type="text"
        />
      </div>
      <div>
        <label
          class="mb-1 text-sm font-medium text-gray-700 dark:text-gray-300 block"
        >
          Email
        </label>
        <input
          class="rounded-lg border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-white w-full border"
          formControlName="email"
          type="email"
        />
      </div>
      <div>
        <label
          class="mb-1 text-sm font-medium text-gray-700 dark:text-gray-300 block"
        >
          Role
        </label>
        <select
          class="rounded-lg border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-white w-full border"
          formControlName="role"
        >
          <option value="user">user</option>
          <option value="admin">admin</option>
        </select>
      </div>
      <div>
        <label
          class="mb-1 text-sm font-medium text-gray-700 dark:text-gray-300 block"
        >
          Image URL
        </label>
        <input
          class="rounded-lg border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-white w-full border"
          formControlName="image"
          type="url"
        />
      </div>
      <div class="sm:col-span-2">
        <label
          class="gap-2 text-sm text-gray-700 dark:text-gray-300 inline-flex items-center"
        >
          <input
            class="size-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"
            formControlName="emailVerified"
            type="checkbox"
          />
          Email verified
        </label>
      </div>
      @if (mode === 'create') {
        <div class="sm:col-span-2">
          <label
            class="mb-1 text-sm font-medium text-gray-700 dark:text-gray-300 block"
          >
            Password
          </label>
          <input
            class="rounded-lg border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-white w-full border"
            formControlName="password"
            type="password"
          />
        </div>
      }
    </div>

    <div>
      <p
        class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"
      >
        RBAC Roles
      </p>
      <div class="gap-2 sm:grid-cols-2 grid">
        @for (role of roles; track role.id) {
          <label
            class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-sm text-gray-800 transition hover:bg-gray-100 dark:border-slate-600/70 dark:bg-slate-800/45 dark:text-slate-100 dark:hover:bg-slate-700/55"
          >
            <input
              class="size-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"
              type="checkbox"
              [checked]="isRoleSelected(role.id)"
              (change)="
                onRoleCheckboxChange(
                  role.id,
                  $event
                )
              "
            />
            <span>{{ role.name }}</span>
          </label>
        }
      </div>
    </div>

    <div class="gap-2 flex justify-end">
      <button
        class="app-btn-secondary"
        type="button"
        (click)="onClose()"
      >
        Cancel
        <span class="app-kbd">ESC</span>
      </button>
      <button
        class="app-btn-primary"
        type="submit"
        [disabled]="isSavingUser()"
      >
        {{ isSavingUser() ? 'Saving...' : 'Save' }}
        @if (!isSavingUser()) {
          <span class="app-kbd">ENTER</span>
        }
      </button>
    </div>
  </form>
</div>
